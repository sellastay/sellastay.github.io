<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="img/favicon.png">
    <!--CSS-->
    <link rel="stylesheet" href="css/style.css">

    <!-- Boxicons CSS -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Json manifest for mobile icon App -->
    <link rel="manifest" href="js/manifest.json">
    <meta name="theme-color" content="#000">
    
    <title>SellaStay - Soluções Comerciais para Hotelaria</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');

        * {
            padding: 0;
            margin: 0;box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(90deg, #e2e2e2, #c9d6ff), url('img/background.png');
            background-size: cover;
            background-position: center;
            /* background-blend-mode: overlay;  */
        }

        .container {
            position: relative;
            width: 850px;
            height: 550px;
            background: #fff;
            border-radius: 30px;
            box-shadow: 0 0 30px rgba(0, 0, 0, .2);
            margin: 20px;
            overflow: hidden;
        }

        .form-box {
            position: absolute;
            right: 0;
            width: 50%;
            height: 100%;
            background: #fff;
            display: flex;
            align-items: center;
            color: #333;
            text-align: center;
            padding: 40px;
            z-index: 1;
            transition: .4s ease-in-out 1.2s, visibility 0s 1s;
        }

        .container.active .form-box {
            right: 50%;
        }

        .form-box.register {
            visibility: hidden;
        }

        .container.active .form-box.register {
            visibility: visible;
        }

        form {
            width: 100%;
        }

        .input-box {
            position: relative;
            margin: 30px 0;
        }

        .input-box input {
            width: 100%;
            padding: 13px 50px 13px 20px;
            background: #eee;
            border-radius: 8px;
            border: none;
            outline: none;
            font-size: 16px;
            color: #333;
            font-weight: 700;
        }

        .input-box input::placeholder {
            color: #888;
            font-weight: 400;
        }

        .input-box i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #888;
        }

        .forgot-link{
            margin: -15px 0 15px;
        }

        .forgot-link a {
            font-size: 12.5px;
            color: #333;
            text-decoration: none;
            transition: .4s;
        }
        .forgot-link a span:hover {
            color: #00b8cc;
        }

        .btn {
            width: 100%;
            height: 48px;
            background: #132d61;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, .1);
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #fff;
            font-weight: 600;
            transition: .4s;
        }
        .btn:hover {
            background: #193993;
        }

        .container p {
            font-size: 14.5px;
            margin: 15px 0;
        }

        .social-icons {
            display: flex;
            justify-content: center;
        }

        .social-icons a {
            display: inline-flex;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 26px;
            color: #333;
            text-decoration: none;
            margin: 0 8px;
            cursor: pointer;
        }
        .social-icons .google:hover {
            color: #07852b; 
        }
        .social-icons .face:hover {
            color: #3b5998;
            
        }
        .social-icons .insta:hover {
            color: #E1306C;
            
        }
        .social-icons .in:hover {
            color: #0e76a8;
        }

        .toggle-box {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .toggle-box img {
            /* margin-top: -300px; */
            width: 250px;
            height: auto;
        }

        .toggle-box::before {
            content: '';
            position: absolute;
            left: -250%;
            width: 300%;
            height: 100%;
            background: linear-gradient(90deg, #132d61, #000000a2), url('img/background_.png');
            background-position: left;
            border-radius: 150px;
            z-index: 2;
            transition: 1.2s ease-in-out;
        }

        .container.active .toggle-box::before {
            left: 50%;
        }

        .toggle-panel {
            position: absolute;
            width: 50%;
            height: 100%;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transition: .4s ease-in-out;
        }

        #saudacaoo {
            text-align: center;
        }
        #lgtop {
            margin-bottom: 50px;
        }
        #dataHora {
            color: #888;
            font-size: 12px;
            margin-top: 5px;
            text-align: center;
        }
        #loginForm {
            margin-top: -100px;
        }

        #btn-password {
            cursor: pointer;
        }
        #btn-passwordz {
            cursor: pointer;
        }

        .toggle-panel.toggle-left {
            left: 0;
            transition-delay: 1s;
        }

        .container.active .toggle-panel.toggle-left {
            left: -50%;
            transition-delay: .4s;
        }

        .toggle-panel.toggle-right {
            right: -50%;
            transition-delay: .4s;
        }

        .container.active .toggle-panel.toggle-right {
            right: 0;
            transition-delay: 1s;
        }

        .toggle-panel p {
            margin-top: -5px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .toggle-panel .btn {
            width: 160px;
            height: 46px;
            background: transparent;
            border: 2px solid #fff;
            box-shadow: none;
            transition: .4s;
        }
        .toggle-panel .btn:hover {
            background: transparent;
            border: 2px solid #fb8851;
            color: #fb8851;
        }

        /* Modal de recuperação */
        #modal-recuperacao {
            position: fixed;
            z-index: 999;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.699);
            backdrop-filter: blur(5px); /* Aplica o efeito de desfoque de 10px */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.834);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            position: relative;
            text-align: center;
            color: #333;
        }

        .modal-content h2 {
            margin-bottom: 10px;
        }

        .modal-content p {
            margin-bottom: 20px;
        }

        .modal-content input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            background: transparent;
            border: 2px solid #132d61;
            margin-bottom: 15px;
            outline: none;
            color: #333;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
        }

        /* Mensagem de sucesso */
        #mensagem-sucesso {
            position: fixed;
            z-index: 1000;
            top: 20px;
            right: 20px;
            background: #132d61;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 14px;
        }

        @media screen and (max-width: 650px) {
            .container {
                height: calc(100vh - 40px);
            }

            body {
                background: #fff;
            }

            .form-box {
                bottom: 0;
                width: 100%;
                height: 70%;
            }

            .container.active .form-box {
                right: 0;
                bottom: 30%;
            }

            .toggle-box img {
                width: 115px;
                margin-bottom: -30px;
            }

            .toggle-box::before {
                left: 0;
                top: -270%;
                width: 100%;
                height: 302%;
                border-radius: 20vw;
            }

            .container.active .toggle-box::before {
                left: 0;
                top: 80%;
            }

            .toggle-panel {
                width: 100%;
                height: 32%;
                margin-bottom: 10px;
            }

            .toggle-panel.toggle-left {
                left: 0;
                top: 5.5%;
            }

            .container.active .toggle-panel.toggle-left {
                left: 0;
                top: -50%;
            }

            .toggle-panel.toggle-right {
                right: 0;
                bottom: -35%;
            }

            .container.active .toggle-panel.toggle-right {
                bottom: -5px;
            }
            .container.active .toggle-panel.toggle-right img {
                display: none;
            }
            .container.active .toggle-panel.toggle-right, #createAccount {
                margin-top: 60px;
                margin-bottom: -20px;
            }
            .container.active .toggle-panel.toggle-right, #createP {
                font-size: 12px;
            }

            footer {
                display: none;
            }
        }

        @media screen and (max-width: 400px) {
            .form-box {
                padding: 25px;
            }

            .toggle-panel h1 {
                font-size: 30px;
            }
        }
    </style>
    
</head>
<body>

    <div class="container">
        <!-- LOGIN BOX -->
        <div class="form-box login">
            
            <form action="home.html" id="loginForm" method="post">
                <div id="lgtop">
                    <h4 id="saudacaoo"> </h4>
                    <p class="data-hora" id="dataHora"></p>
                </div>
                <h1>Login</h1>
                <div class="input-box">
                    <input type="text" placeholder="Usuário" id="username" name="username" required>
                    <i class='bx bx-user'></i>
                </div>
                <div class="input-box">
                    <input type="password" placeholder="Senha" id="password" name="password" required>
                    <i class='bx bxs-lock' id="btn-password" onclick="showPassword()"></i>
                </div>
                <div class="forgot-link">
                    <a href="#">Esqueceu sua senha?<span> Recupere aqui</span></a>
                </div>
                <button type="submit" class="btn">Entrar</button>
                <p id="createP" style="display: none;">ou faça login usando plataformas sociais:</p>
                <div class="social-icons" style="display: none;">
                    <a href="#"><i class='bx bxl-google google' ></i></a>
                    <a href="#"><i class='bx bxl-facebook face' ></i></a>
                    <a href="#"><i class='bx bxl-instagram insta' ></i></a>
                    <a href="#"><i class='bx bxl-linkedin in' ></i></a>
                </div>
            </form>
        </div>
        <!-- /LOGIN BOX -->

        <!-- SIGNUP BOX -->
        <div class="form-box register">
            <form action="" method="POST" name="accountForm">
                <input type="hidden" name="formType" value="new">
                <h1 id="createAccount">Crie sua conta</h1>
                <div class="input-box">
                    <input type="text" name="nome" placeholder="Nome" required>
                    <i class='bx bx-user'></i>
                </div>
                <div class="input-box">
                    <input type="email" name="email" placeholder="E-mail" required>
                    <i class='bx bxl-gmail' ></i>
                </div>
                <div class="input-box">
                    <input type="password" name="password" id="passwordz" placeholder="Crie uma senha" required>
                    <i class='bx bxs-lock' id="btn-passwordz" onclick="showPasswordz()"></i>
                </div>
                <div class="forgot-link">
                    <a href="#">Esqueceu sua senha?<span> Recupere aqui</span></a>
                </div>
                <button type="submit" class="btn">Criar conta</button>
                <p id="createP" style="display: none;">ou faça login usando plataformas sociais:</p>
                <div class="social-icons" style="display: none;">
                    <a href="#"><i class='bx bxl-google google' ></i></a>
                    <a href="#"><i class='bx bxl-facebook face' ></i></a>
                    <a href="#"><i class='bx bxl-instagram insta' ></i></a>
                    <a href="#"><i class='bx bxl-linkedin in' ></i></a>
                </div>
            </form>
        </div>
        <!-- /SIGNUP BOX -->

        <div class="toggle-box">
            <div class="toggle-panel toggle-left">
                <img src="img/aurora_logo3.png" style="filter: brightness(2.8);">
                <br>
                <p>Ainda não tem uma conta?</p>
                <button class="btn register-btn">Criar conta</button>
            </div>
            
            <div class="toggle-panel toggle-right">
                <img src="img/aurora_logo3.png" style="filter: brightness(2.8);">
                <h1 id="saudacao"></h1>
                <p class="data-hora" id="dataHora"></p>
                <p>Já tem uma conta?</p>
                <button class="btn login-btn">Faça Login</button>
            </div>
        </div>
    </div>

    <!-- Modal de Recuperação de Senha -->
    <div id="modal-recuperacao" style="display: none;">
        <div class="modal-content">
            <h2>Recuperar Acesso</h2>
            <p>Digite seu e-mail que em até <b>24h</b> enviaremos seu novo acesso:</p>
            <form id="form-recuperacao" method="POST" name="accountForm">
                <input type="hidden" name="formType" value="forgot">
                <input type="email" name="email" id="email-recuperacao" placeholder="Digite seu e-mail" required>
                <button type="submit" class="btn">Enviar</button>
            </form>
            <span class="close-modal">&times;</span>
        </div>
    </div>
    <!-- Mensagem de confirmação -->
    <div id="mensagem-sucesso" style="display: none;">
        <p>✔️ Solicitação de recuperação de acesso enviada!</p>
    </div>
    <!-- /Modal de Recuperação de Senha -->

    <!--Footer -->
    <Footer style="line-height: 15px;">
        &copy; <span id="anoAtual"></span> SellaStay - Soluções Comerciais para Hotelaria. <br> <span style="font-size: 10px; cursor: pointer;">Desenvolvido por <a href="https://www.syncsoftware.com.br" style="text-decoration: none; color: var(--text-color);" onmouseover="this.style.color='#ff914d';" onmouseout="this.style.color='var(--text-color)';" target="_blank"> <b>Sync Software LTDA</b></a></span>
    </Footer>

    <script>
        function obterSaudacao() {
            const agora = new Date();
            const hora = agora.getHours();

            let saudacao = "";
            
            if (hora >= 6 && hora < 12) {
                saudacao = "Bom dia!";
            } else if (hora >= 12 && hora < 18) {
                saudacao = "Boa tarde!";
            } else {
                saudacao = "Boa noite!";
            }

            return saudacao;
        }

        document.getElementById("saudacaoo").textContent = obterSaudacao();


        function updateDataHora() {
        const data = new Date();
        const options = {
            weekday: "long",
            day: "numeric",
            month: "long",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit",
        };
        const dataHoraFormatada = data.toLocaleString("pt-BR", options);
        document.getElementById("dataHora").textContent = dataHoraFormatada;
        }

        document.getElementById("anoAtual").textContent = new Date().getFullYear();

        setInterval(updateDataHora, 1000);

        const loginForm = document.getElementById("loginForm");

        if (loginForm) {
            loginForm.addEventListener("submit", async function(event) {
                event.preventDefault();

                const formData = new FormData(loginForm);

                try {
                const response = await fetch("api/login.php", {
                    method: "POST",
                    body: formData,
                    credentials: "include"
                });
                const payloadText = await response.text();
                let data;

                try {
                    data = JSON.parse(payloadText);
                } catch (jsonError) {
                    throw new Error("Resposta inesperada do servidor: " + payloadText);
                }

                if (!response.ok || data.status !== "success") {
                    throw new Error(data.message ?? "Usuário ou senha inválidos.");
                }

                mostrarMensagemSucesso("Login realizado! Redirecionando...", 2000);

                setTimeout(() => {
                    window.location.href = data.redirect || "home.html";
                }, 1400);
            } catch (error) {
                console.error("Erro ao efetuar login:", error);
                mostrarMensagemErro(error.message ?? "Não foi possível efetuar login. Tente novamente.");
            }
            });
        }

        function showPassword() {
            var inputPass = document.getElementById('password');
            var btnShowPass = document.getElementById('btn-password');

            if (inputPass.type === 'password') {
                inputPass.setAttribute('type', 'text');
                // Troca o ícone para o cadeado aberto
                btnShowPass.classList.remove('bx', 'bxs-lock');
                btnShowPass.classList.add('bx', 'bxs-lock-open');
            } else {
                inputPass.setAttribute('type', 'password');
                // Troca o ícone para o cadeado fechado
                btnShowPass.classList.remove('bx', 'bxs-lock-open');
                btnShowPass.classList.add('bx', 'bxs-lock');
            }
        }
        function showPasswordz() {
            var inputPass = document.getElementById('passwordz');
            var btnShowPass = document.getElementById('btn-passwordz');

            if (inputPass.type === 'password') {
                inputPass.setAttribute('type', 'text');
                // Troca o ícone para o cadeado aberto
                btnShowPass.classList.remove('bx', 'bxs-lock');
                btnShowPass.classList.add('bx', 'bxs-lock-open');
            } else {
                inputPass.setAttribute('type', 'password');
                // Troca o ícone para o cadeado fechado
                btnShowPass.classList.remove('bx', 'bxs-lock-open');
                btnShowPass.classList.add('bx', 'bxs-lock');
            }
        }

    </script>

    <script>
        const container = document.querySelector('.container');
        const registerBtn = document.querySelector('.register-btn');
        const loginBtn = document.querySelector('.login-btn');

        registerBtn.addEventListener('click', () => {
            container.classList.add('active');
        });

        loginBtn.addEventListener('click', () => {
            container.classList.remove('active');
        });
    </script>

    <!-- LOGIN SCRIPT -->
    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbyF0gMPiz4sPIcuvcyoT2RBbs195IuRBk834rsm6LVHd67sjyJHsn2fgOv_kqiKYjr3Mw/exec";
        
        const accountForm = document.forms['accountForm'];

        accountForm.addEventListener('submit', e => {
            e.preventDefault();

            const formData = new FormData(accountForm);
            formData.append('action', 'login');

            fetch(scriptURL, { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                console.log("Resposta do servidor (new user):", data);
                
                if (data.result === "success" || data.status === "success") {
                    // CORREÇÃO: Criar mensagem específica para cadastro
                    mostrarMensagemSucesso("Sua conta foi criada com sucesso! Verifique seu e-mail nas próximas horas.", 4000);

                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 4000);
                } else {
                    console.error('Erro na resposta:', data);
                    alert('Erro ao processar solicitação. Tente novamente.');
                }
            })
            .catch(error => {
                console.error('Erro no envio:', error);
                alert('Erro ao enviar. Tente novamente.');
            });
        });

        // Envio do formulário de recuperação de senha
        const recoveryForm = document.getElementById('form-recuperacao');

        if (recoveryForm) {
            recoveryForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const email = document.getElementById('email-recuperacao').value;

                const formData = new FormData();
                formData.append('action', 'login');
                formData.append('email', email);
                formData.append('formType', 'forgot');

                fetch(scriptURL, { method: 'POST', body: formData })
                    .then(response => response.json())
                    .then(data => {
                        console.log("Resposta do servidor (recovery):", data);
                        
                        if (data.result === "success" || data.status === "success") {
                            // Fecha o modal
                            const modal = document.getElementById('modal-recuperacao');
                            if (modal) {
                                modal.style.display = 'none';
                            }

                            // Limpa o campo
                            recoveryForm.reset();

                            // CORREÇÃO: Criar mensagem específica para recuperação
                            mostrarMensagemSucesso("Solicitação de recuperação enviada! Verifique seu e-mail em até 24h.", 3000);

                            console.log("Solicitação de recuperação enviada com sucesso!");
                        } else {
                            console.error('Erro na resposta:', data);
                            alert('Erro ao processar solicitação de recuperação. Tente novamente.');
                        }
                    })
                    .catch(error => {
                        console.error('Erro no envio:', error);
                        alert('Erro ao enviar. Tente novamente.');
                    });
            });
        }

        // NOVA FUNÇÃO: Mostrar mensagem de sucesso personalizada
        function mostrarMensagemSucesso(mensagem, duracao = 3000) {
            // Remover mensagem anterior se existir
            const mensagemAnterior = document.getElementById('mensagem-dinamica');
            if (mensagemAnterior) {
                mensagemAnterior.remove();
            }

            // Criar nova mensagem
            const mensagemDiv = document.createElement('div');
            mensagemDiv.id = 'mensagem-dinamica';
            mensagemDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 2000;
                font-family: 'Poppins', sans-serif;
                font-size: 14px;
                font-weight: 500;
                max-width: 300px;
                opacity: 0;
                transition: opacity 0.5s ease-in-out;
            `;
            
            mensagemDiv.textContent = mensagem;
            document.body.appendChild(mensagemDiv);

            // Mostrar com animação
            setTimeout(() => {
                mensagemDiv.style.opacity = '1';
            }, 100);

            // Esconder após o tempo especificado
            setTimeout(() => {
                mensagemDiv.style.opacity = '0';
                setTimeout(() => {
                    if (mensagemDiv.parentNode) {
                        mensagemDiv.remove();
                    }
                }, 500);
            }, duracao);
        }

        function mostrarMensagemErro(mensagem, duracao = 3500) {
            const mensagemAnterior = document.getElementById('mensagem-dinamica');
            if (mensagemAnterior) {
                mensagemAnterior.remove();
            }

            const mensagemDiv = document.createElement('div');
            mensagemDiv.id = 'mensagem-dinamica';
            mensagemDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 2000;
                font-family: 'Poppins', sans-serif;
                font-size: 14px;
                font-weight: 500;
                max-width: 320px;
                opacity: 0;
                transition: opacity 0.5s ease-in-out;
            `;
            
            mensagemDiv.textContent = mensagem;
            document.body.appendChild(mensagemDiv);

            setTimeout(() => {
                mensagemDiv.style.opacity = '1';
            }, 100);

            setTimeout(() => {
                mensagemDiv.style.opacity = '0';
                setTimeout(() => {
                    if (mensagemDiv.parentNode) {
                        mensagemDiv.remove();
                    }
                }, 500);
            }, duracao);
        }

        // Abrir modal
        document.querySelectorAll('.forgot-link a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const modal = document.getElementById('modal-recuperacao');
                if (modal) {
                    modal.style.display = 'flex';
                }
            });
        });

        // Fechar modal
        const closeModal = document.querySelector('.close-modal');
        if (closeModal) {
            closeModal.addEventListener('click', () => {
                const modal = document.getElementById('modal-recuperacao');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Fechar modal clicando fora dele
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('modal-recuperacao');
            if (modal && e.target === modal) {
                modal.style.display = 'none';
            }
        });
    </script>
    <!-- /LOGIN SCRIPT -->

</body>
</html>